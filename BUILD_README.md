# Sourcehold Maps Converter - Инструкции по сборке

Этот проект создает единый инсталлер для конвертера карт Sourcehold, который автоматически устанавливает все необходимые зависимости.

## Что включает инсталлер

1. **Python 3.11** - если не установлен
2. **Visual C++ Redistributable 2015-2022** - для работы Python пакетов
3. **Python зависимости:**
   - Pillow (обработка изображений)
   - pymem (работа с памятью процесса)
   - dclimplode (сжатие/распаковка)
   - numpy (математические операции)
   - opencv-python (компьютерное зрение)
4. **GUI приложение** для конвертации карт
5. **Ярлыки** на рабочем столе и в меню Пуск

## Требования для сборки

### Windows
- Python 3.8+
- NSIS (Nullsoft Scriptable Install System)
- Интернет-соединение для загрузки зависимостей

### Установка NSIS
1. Скачайте NSIS с https://nsis.sourceforge.io/Download
2. Установите NSIS
3. Добавьте NSIS в PATH (обычно `C:\Program Files (x86)\NSIS`)

## Сборка инсталлера

### Автоматическая сборка (рекомендуется)
```bash
python build_installer.py
```

Этот скрипт автоматически выполнит все шаги:
1. Загрузит зависимости
2. Установит Python пакеты
3. Соберет исполняемый файл
4. Создаст инсталлер

### Ручная сборка

Если вы хотите выполнить шаги вручную:

1. **Загрузить зависимости:**
   ```bash
   python download_dependencies.py
   ```

2. **Установить Python зависимости:**
   ```bash
   pip install -r requirements.txt
   pip install pyinstaller
   ```

3. **Собрать исполняемый файл:**
   ```bash
   python build_exe.py
   ```

4. **Создать инсталлер:**
   ```bash
   makensis installer.nsi
   ```

## Результат

После успешной сборки вы получите файл `SourceholdMapsConverter-Setup.exe` - единый инсталлер, который:

- Автоматически установит все зависимости
- Создаст ярлык на рабочем столе
- Добавит приложение в меню Пуск
- Зарегистрирует приложение для удаления через "Программы и компоненты"

## Структура файлов

```
├── installer.nsi              # NSIS скрипт инсталлера
├── sourcehold_converter_gui.py # GUI приложение
├── build_exe.py               # Скрипт сборки .exe
├── download_dependencies.py   # Скрипт загрузки зависимостей
├── build_installer.py         # Главный скрипт сборки
├── dependencies/              # Папка с зависимостями
│   ├── python-3.11.8-amd64.exe
│   └── vc_redist.x64.exe
└── dist/                      # Папка с результатом
    └── sourcehold-converter.exe
```

## Возможные проблемы

### NSIS не найден
Убедитесь, что NSIS установлен и добавлен в PATH:
```bash
makensis /VERSION
```

### Ошибки загрузки зависимостей
Проверьте интернет-соединение и попробуйте загрузить зависимости вручную.

### Ошибки сборки .exe
Убедитесь, что все Python зависимости установлены:
```bash
pip install -r requirements.txt pyinstaller
```

## Использование инсталлера

1. Запустите `SourceholdMapsConverter-Setup.exe`
2. Следуйте инструкциям установщика
3. После установки на рабочем столе появится ярлык "Sourcehold Maps Converter"
4. Запустите приложение и выберите файлы для конвертации

## Поддерживаемые форматы

- **Входные файлы:** .map, .sav, .msv (файлы карт Stronghold Crusader)
- **Операции:** распаковка файлов в папки и упаковка папок в файлы